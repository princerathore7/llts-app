<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7342369119079593"
     crossorigin="anonymous"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />

  <title>Post Tender | LLTS</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet">
  
  <!-- ‚úÖ AdSense script -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7342369119079593"
    crossorigin="anonymous"></script>
  <style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Inter', sans-serif;
  }

  body {
    background: linear-gradient(to bottom right, #141e30, #243b55);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px 16px;
    color: #fff;
  }

  .container {
    max-width: 640px;
    width: 100%;
    background-color: #1f2a40;
    padding: 35px 24px;
    border-radius: 18px;
    box-shadow: 0 14px 40px rgba(0, 0, 0, 0.4);
  }

  h1 {
    text-align: center;
    color: #2ecc71;
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 26px;
  }

  label {
    font-weight: 500;
    font-size: 0.95rem;
    display: block;
    margin: 14px 0 6px;
  }

  input, textarea, select {
    width: 100%;
    padding: 12px 16px;
    border-radius: 10px;
    border: 1px solid #444;
    background: #2c3e50;
    color: #fff;
    font-size: 0.95rem;
  }

  input:focus, textarea:focus, select:focus {
    border-color: #2ecc71;
    outline: none;
    box-shadow: 0 0 6px #2ecc7190;
  }

  textarea {
    resize: vertical;
    min-height: 100px;
  }

  .btn-submit {
    margin-top: 26px;
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(to right, #2ecc71, #27ae60);
    color: #1e1e1e;
    font-weight: bold;
    font-size: 1rem;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .btn-submit:hover {
    transform: scale(1.02);
  }

  .note {
    font-size: 0.8rem;
    color: #ccc;
    text-align: center;
    margin-top: 14px;
    font-style: italic;
  }

  .back-link {
    display: block;
    text-align: center;
    margin-top: 20px;
    font-size: 0.9rem;
    color: #ccc;
    text-decoration: underline;
  }

  .back-link:hover {
    color: #2ecc71;
  }

  @media (max-width: 480px) {
    .container {
      padding: 28px 18px;
      border-radius: 12px;
    }

    h1 {
      font-size: 1.6rem;
    }

    .btn-submit {
      font-size: 0.95rem;
    }

    input, textarea, select {
      font-size: 0.9rem;
      padding: 10px 14px;
    }
  }
</style>


</head>
<body>
  <div class="container">
    
    <h1>üìÑ Post a Tender</h1>
    <div style="background-color: #e0f7fa; color: #004d40; border: 1px solid #4dd0e1; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
  üí¨ <strong>Notice:</strong> After you post a tender, workers will contact you directly via WhatsApp. The "Received Applications" feature is still in development.
</div>

    <!-- ‚úÖ Ad unit -->
    <div style="text-align:center; margin-bottom: 20px;">
      <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-7342369119079593"
        data-ad-slot="1234567890"  <!-- replace with real slot when approved -->
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>

    <form id="postTenderForm">
      <label for="tenderTitle">Tender Title</label>
      <input type="text" id="tenderTitle" placeholder="Enter tender title" required />
      <label for="phone">Contact Mobile Number (üì±)</label>
<input type="tel" id="phone" placeholder="Enter your contact number" required />

      <label for="tenderDescription">Work Description</label>
      <textarea id="tenderDescription" placeholder="Explain the work in detail..." required></textarea>

      <label for="price">Offered Price (‚Çπ)</label>
      <input type="number" id="price" placeholder="Enter offered price" min="0" required />

      <label for="location">Location</label>
      <input type="text" id="location" placeholder="e.g. Indore, MP" required />

      <label for="deadline">Deadline</label>
      <input type="date" id="deadline" required />

      <label for="category">Work Category</label>
      <select id="category" required>
        <option value="">-- Select Category --</option>
        <option value="All Categories">All Categories</option>
        <option value="Electrician">Electrician</option>
        <option value="Plumbing">Plumbing</option>
        <option value="Carpentry">Carpentry</option>
        <option value="Masonry">Masonry</option>
        <option value="Gardening">Gardening</option>
        <option value="Cleaning">Cleaning</option>
        <option value="Painting">Painting</option>
        <option value="Student Work">Student Work</option>
        <option value="IT Support">IT Support</option>
        <option value="Mechanic">Mechanic</option>
        <option value="General Help">General Help</option>
        <option value="Other">Other</option>
      </select>

      <button type="submit" class="btn-submit">Submit Tender</button>
    </form>

    <p class="note">Note: This tender will be visible to workers matching the selected category.</p>
    <a href="ownerdashboard.html" class="back-link">‚Üê Back to Dashboard</a>
  </div>

  <script>
  const API_BASE = "https://llts-app.onrender.com/api";

  document.getElementById('postTenderForm')?.addEventListener('submit', async function (e) {
    e.preventDefault();

    const token = localStorage.getItem('token');
    if (!token) {
      alert("You're not logged in.");
      return;
    }

    const tender = {
      title: document.getElementById('tenderTitle').value.trim(),
      description: document.getElementById('tenderDescription').value.trim(),
      budget: parseInt(document.getElementById('price').value),
      location: document.getElementById('location').value.trim(),
      deadline: document.getElementById('deadline').value,
      category: document.getElementById('category').value,
      phone: document.getElementById('phone').value.trim()
    };

    // Basic field validation
    for (let key in tender) {
      if (!tender[key]) {
        alert(`Please fill in the ${key} field.`);
        return;
      }
    }

    try {
      const res = await fetch(`${API_BASE}/tenders`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(tender)
      });

      const result = await res.json();

      if (res.ok) {
        alert(result.message || "Tender posted successfully.");
        this.reset();
      } else {
        alert(result.error || "Failed to post tender.");
      }
    } catch (error) {
      console.error("Tender Post Error:", error);
      alert("Something went wrong while posting the tender.");
    }
  });

  function parseJwt(token) {
    try {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    } catch (e) {
      return null;
    }
  }
</script>

</body>
</html>
